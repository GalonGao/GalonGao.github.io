(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{344:function(s,a,n){"use strict";n.r(a);var t=n(3),e=Object(t.a)({},function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[n("strong",[s._v("强缓存")]),s._v("：一般设置Cache-Control的值为“public, max-age=xxx”，表示在xxx秒内再次访问该资源，均使用本地的缓存，不再向服务器发起请求。==问题：XXX秒内如果服务器资源更新了，只能强刷否则有问题。==")]),s._v(" "),n("p",[n("strong",[s._v("协商缓存")]),s._v("：每次都要向服务器验证一下缓存的有效性。")]),s._v(" "),n("h2",{attrs:{id:"实践方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实践方案","aria-hidden":"true"}},[s._v("#")]),s._v(" 实践方案")]),s._v(" "),n("ul",[n("li",[s._v("HTML：使用协商缓存。")]),s._v(" "),n("li",[s._v("CSS&JS&图片：使用强缓存，文件命名带上hash值。")])]),s._v(" "),n("p",[s._v("webpack可以让我们在打包的时候，在文件的命名上带上hash值，解决强缓存要强刷的问题。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("entry:{\n    main: path.join(__dirname,'./main.js'),\n    vendor: ['react', 'antd']\n},\noutput:{\n    path:path.join(__dirname,'./dist'),\n    publicPath: '/dist/',\n    filname: 'bundle.[chunkhash].js'\n}\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h2",{attrs:{id:"哈希（webpack提供三种）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#哈希（webpack提供三种）","aria-hidden":"true"}},[s._v("#")]),s._v(" 哈希（webpack提供三种）")]),s._v(" "),n("ul",[n("li",[s._v("hash：跟整个项目的构建相关，构建生成的文件hash值都是一样的，只要项目里有文件更改，整个项目构建的hash值都会更改。（==改一个文件，缓存就失效了，不用==）")]),s._v(" "),n("li",[s._v("chunkhash：根据不同的入口文件(Entry)进行依赖文件解析、构建对应的chunk，生成对应的hash值。")]),s._v(" "),n("li",[s._v("contenthash：由文件内容产生的hash值，内容不同产生的contenthash值也不一样。")])]),s._v(" "),n("h2",{attrs:{id:"etag什么东东"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#etag什么东东","aria-hidden":"true"}},[s._v("#")]),s._v(" Etag什么东东")]),s._v(" "),n("ul",[n("li",[s._v('Nginx官方默认的Etag计算方式是为"文件最后修改时间16进制-文件长度16进制"。')]),s._v(" "),n("li",[s._v("Express框架：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 方式一：使用文件大小和修改时间\nfunction stattag (stat) {\n  var mtime = stat.mtime.getTime().toString(16)\n  var size = stat.size.toString(16)\n\n  return '\"' + size + '-' + mtime + '\"'\n}\n// 方式二：使用文件内容的hash值和内容长度\nfunction entitytag (entity) {\n  if (entity.length === 0) {\n    // fast-path empty\n    return '\"0-2jmj7l5rSw0yVb/vlWAYkK/YBwk\"'\n  }\n\n  // compute hash of entity\n  var hash = crypto\n    .createHash('sha1')\n    .update(entity, 'utf8')\n    .digest('base64')\n    .substring(0, 27)\n\n  // compute length of entity\n  var len = typeof entity === 'string'\n    ? Buffer.byteLength(entity, 'utf8')\n    : entity.length\n\n  return '\"' + len.toString(16) + '-' + hash + '\"'\n}\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("h3",{attrs:{id:"etag怎么传"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#etag怎么传","aria-hidden":"true"}},[s._v("#")]),s._v(" Etag怎么传")]),s._v(" "),n("p",[s._v('Etag是 Entity tag的缩写，可以理解为“被请求变量的实体值”，Etag是服务端的一个资源的标识，在 HTTP 响应头中将其传送到客户端。所谓的服务端资源可以是一个Web页面，也可以是JSON或XML等。服务器单独负责判断记号是什么及其含义，并在HTTP响应头中将其传送到客户端。比如，浏览器第一次请求一个资源的时候，服务端给予返回，并且返回了Etag: "50b1c1d4f775c61:df3" 这样的字样给浏览器，当浏览器再次请求这个资源的时候，浏览器会将If-None-Match: "50b1c1d4f775c61:df3" 传输给服务端，服务端拿到该ETAG，对比资源是否发生变化，如果资源未发生改变，则返回304HTTP状态码，不返回具体的资源。')]),s._v(" "),n("p",[s._v("==Last-Modified/If-Modified-Since 类似于Etag/If-None-Match,但Etag优先级高==")]),s._v(" "),n("p",[n("em",[s._v("后端需要怎么设置：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 强缓存\nres.setHeader('Cache-Control', 'public, max-age=xxx');\n// 协商缓存\nres.setHeader('Cache-Control', 'public, max-age=0');\nres.setHeader('Last-Modified', xxx);\nres.setHeader('ETag', xxx);\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])])},[],!1,null,null,null);a.default=e.exports}}]);